package testmain;

import java.net.*;
import java.sql.SQLException;

import java.io.*;

public class AppThread extends Thread
{
	Socket socket = null;

	public AppThread(Socket socket)
	{
		this.socket = socket;
		System.out.println("New thread created");
	}

	public void run()
	{
		System.out.println("Thread started");
		
		try
		{
			DataOutputStream out = new DataOutputStream(socket.getOutputStream());
			DataInputStream in = new DataInputStream(socket.getInputStream());

			int id = 0;
			String result = null;
			ClientApp app = new ClientApp();

			String query = in.readUTF();
			
			String[] components = query.split("-");
			
			switch (components[0])
			{
				case "getNameById" :
					id = Integer.parseInt(components[1]);

					result = app.getClientNameById(id);
					break;
					
				case "addClient" :
					id = Integer.parseInt(components[1]);
					String name = components[2];

					result = app.addClient(id, name);
					break;
					
				default : 
					result = "Default result";
					break;
			}
			
			out.writeUTF(result);
			out.close();
			in.close();
			socket.close();
			
			System.out.println("Thread ended");
		} 
		catch (IOException | SQLException | ClassNotFoundException e)
		{
			System.err.println("Server comunication error : " + e.getMessage());
		}
	}
}
